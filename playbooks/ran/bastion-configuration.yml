---
# - name: Configure Squid Proxy on bastion for ZTP Hub Access in a disconnected environment
#   hosts: bastion
#   become: yes
#   vars:
#     hub_ip: "{{ hub_ip }}" 
#     proxy_port: 3128

#   tasks:

- name: Ensure RHCOS ISO is available for http_store container
  hosts: bastion
  become: yes
  vars:
    http_store_data_dir: /opt/http_store/data
    rhcos_cache_dir: /opt/cache
  tasks:
    - name: Find RHCOS ISO files in cache directory
      ansible.builtin.find:
        paths: "{{ rhcos_cache_dir }}"
        patterns: "rhcos-*.iso"
      register: rhcos_iso_files

    - name: Copy RHCOS ISO to http_store data directory
      ansible.builtin.copy:
        src: "{{ item.path }}"
        dest: "{{ http_store_data_dir }}/{{ item.path | basename }}"
        remote_src: yes
        mode: '0644'
      loop: "{{ rhcos_iso_files.files }}"
      when: rhcos_iso_files.files | length > 0

