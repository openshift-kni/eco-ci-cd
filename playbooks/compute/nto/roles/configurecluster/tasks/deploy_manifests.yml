---
- name: Label worker0 as worker-cnf
  kubernetes.core.k8s:
    kind: Node
    name: worker0
    state: patched
    definition:
      metadata:
        labels:
          node-role.kubernetes.io/worker-cnf: ''
  when: not is_sno | bool

- name: Deploy Machine Config Pool
  kubernetes.core.k8s:
    state: present
    src: "{{ manifests_folder }}/machineConfigPool.yml"
  when: not is_sno | bool
  notify:
    - wait for mcp update

- name: Deploy Container Runtime Configuration
  kubernetes.core.k8s:
    state: present
    src: "{{ manifests_folder }}/ContainerRuntime.yml"
  when: container_runtime_config is defined and container_runtime_config.changed
  notify:
    - wait for mcp update

- name: Deploy Cgroup Configuration
  kubernetes.core.k8s:
    state: present
    src: "{{ manifests_folder }}/CgroupConfiguration.yml"
  notify:
    - wait for mcp update

- name: Deploy Performance Profile
  kubernetes.core.k8s:
    state: present
    src: "{{ manifests_folder }}/PerformanceProfile.yml"
  notify:
    - wait for mcp update
